<div>



    <style>
        #map-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        #map-tooltip {
            position: absolute;
            display: none;
            background: white;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        .region-overlay {
            transition: fill 0.3s ease;
        }

        .region-path {
            fill: url(#gradient) !important;
        }
    </style>

    <div id="map-container">

        <div class="flex justify-between gap-2">
            <x-mary-datetime label="Start Date" wire:model.live="startDate" />
            <x-mary-datetime label="End Date" wire:model.live="endDate" />
        </div>

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="-3.181 0 713.784 627.662">



            <defs>
                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">

                    @php
                        $total = $this->crimes->count();
                        $now = 0;
                    @endphp



                    @foreach ($this->crimes->unique('crime_type')->pluck('crime_type') as $crime)
                        @php
                            $thisType = $this->crimes->where('crime_type', $crime)->count();

                            $percentage = ($thisType / $total) * 100;

                            $now += $percentage;

                        @endphp

                        <stop offset="{{ $now }}%" style="stop-color: {{ $crime }}" />
                    @endforeach

                </linearGradient>
            </defs>

            @if ($selectedUnion)
                {!! $selectedUnionDetails->path !!}

            @else

            <path fill="url(#gradient)" d="M 213.862 188.046 C 211.083 184.553 214.897 185.244 214.897 175.6 C 214.897 165.957 245.893 167.338 214.897 165.957 C 183.903 164.575 226.775 146.93 183.903 164.584 C 152.864 177.343 156.014 177.673 156.014 177.673 C 149.157 173.47 141.908 169.557 134.314 165.957 C 122.301 160.219 118.817 162.012 118.817 162.012 C 118.817 162.012 120.891 174.029 105.393 170.694 C 89.895 167.36 85.765 161.83 85.765 161.83 L 59.935 161.83 L 45.475 165.276 L 34.121 178.355 L 15.53 187.999 L -4.097 196.961 L -4.097 230.707 L 7.256 245.179 C 7.256 245.179 4.163 245.179 4.163 261.021 L 4.163 276.863 L 19.662 273.417 L 41.343 272.046 L 69.247 264.977 L 89.895 264.977 L 120.891 253.44 L 145.685 247.931 L 177.716 233.472 L 185.974 223.137 L 193.213 209.357 L 201.487 199.715 L 213.862 188.046 Z M 65.099 350.577 C 65.099 350.577 115.725 314.067 145.685 350.577 L 159.11 361.593 C 159.11 361.593 169.784 363.435 169.441 369.173 C 168.553 384.064 181.845 381.571 181.845 381.571 C 181.845 381.571 171.511 380.89 195.269 381.571 C 219.026 382.252 206.637 388.462 219.026 382.263 C 231.416 376.063 230.394 383.643 231.431 376.063 C 232.465 368.483 242.782 368.483 231.431 353.332 L 220.062 338.181 L 210.767 323.708 L 205.603 308.557 L 199.4 285.826 C 199.4 285.826 189.263 260.26 168.406 256.203 C 136.492 249.976 131.435 251.106 131.435 251.106 C 131.435 251.106 110.618 264.977 89.895 264.977 L 69.247 264.977 C 69.247 264.977 51.316 261.971 46.33 270.785 C 41.343 279.597 46.33 290.643 46.33 290.643 L 55.806 301.658 C 55.806 301.658 56.843 300.967 57.879 314.746 L 58.916 328.515 L 52.713 338.851 L 65.099 350.577 Z M 241.748 375.371 C 241.748 375.371 250.531 374.371 257.245 375.371 C 281.182 379.057 269.65 380.199 279.981 381.571 L 290.312 382.953 L 314.069 382.953 L 332.66 384.955 C 332.66 384.955 334.043 387.849 341.955 358.107 C 351.822 321.055 358.473 340.894 364.679 323.669 C 370.879 306.446 388.45 307.828 370.879 306.446 C 353.31 305.063 360.546 317.46 353.326 305.073 C 346.101 292.685 368.822 291.984 346.085 292.665 L 323.365 293.357 C 323.365 293.357 335.155 307.457 307.567 292.486 L 279.981 277.515 L 266.541 264.977 C 266.541 264.977 277.911 259.088 250.023 251.106 C 222.134 243.124 253.116 248.624 222.122 243.095 C 191.125 237.568 204.566 241.715 191.141 237.577 L 177.716 233.453 L 140.412 249.085 L 174.065 257.577 L 199.4 285.806 L 204.475 304.411 C 204.475 304.411 208.695 322.999 220.062 338.161 C 226.26 346.236 231.836 354.518 236.76 362.975 L 241.748 375.371 Z M 188.031 429.106 C 188.031 429.106 188.031 424.281 213.862 417.391 L 239.69 410.501 C 239.69 410.501 242.438 408.097 264.485 402.933 C 294.067 395.991 294.518 396.732 294.518 396.732 L 329.569 389.152 L 332.66 384.995 C 332.66 384.995 346.085 397.413 358.49 397.413 C 370.895 397.413 367.785 403.621 397.746 403.621 L 427.704 403.621 L 443.187 407.046 L 466.959 407.046 L 479.348 429.077 L 483.477 442.227 L 483.477 481.492 C 483.477 481.492 510.344 498.714 492.772 503.523 L 475.217 508.319 L 471.165 508.93 C 465.637 509.77 460.247 508.12 456.628 505.205 C 454.749 503.683 449.116 502.722 435.963 503.494 C 400.839 505.557 411.17 509.692 400.839 505.557 C 390.505 501.42 414.263 502.122 390.505 501.43 C 366.751 500.738 389.472 503.494 366.751 500.738 C 344.029 497.986 363.656 497.293 344.029 497.986 C 324.402 498.676 334.733 496.603 324.402 498.676 L 314.069 500.738 L 298.572 501.43 L 264.485 492.416 C 264.485 492.416 259.557 491.045 236.718 489.663 L 213.862 488.292 L 193.213 488.292 L 169.441 486.289 L 146.659 482.153 C 146.659 482.153 141.494 477.326 164.215 464.928 L 165.252 448.386 C 165.252 448.386 165.252 437.369 176.62 433.244 L 188.031 429.106 Z M 294.443 158.196 C 294.443 158.196 234.524 161.59 264.408 158.196 C 275.627 156.934 280.476 158.366 285.029 154.02 C 287.073 151.914 288.816 149.684 290.237 147.361 C 297.461 136.347 280.928 145.287 297.461 136.347 C 313.995 127.403 295.404 135.654 313.979 127.392 L 332.571 119.121 C 331.534 103.279 333.608 114.303 331.534 103.279 C 329.463 92.253 343.938 105.352 329.477 92.261 L 315.017 79.175 L 308.844 67.448 C 308.844 67.448 293.346 66.757 307.806 52.297 L 322.359 37.826 L 336.099 27.491 L 340.951 24.739 L 353.354 24.739 L 378.509 15.095 C 378.509 15.095 408.105 -7.639 432.899 15.095 C 432.899 15.095 451.49 15.095 441.16 21.293 L 430.827 27.491 L 450.455 33.01 L 470.082 43.345 L 498.764 62.632 L 511.409 79.165 L 511.409 107.404 L 493.841 126 C 493.841 126 492.804 127.382 477.32 143.916 C 467.681 153.982 454.073 162.086 437.99 167.338 L 404.952 181.8 C 404.952 181.8 387.397 188.689 385.325 187.999 L 383.268 187.317 C 383.268 187.317 329.569 170.784 305.84 171.463 L 294.487 158.196 L 294.443 158.196 Z M 214.897 175.6 C 214.897 175.6 212.419 184.945 201.471 199.715 C 190.523 214.485 182.25 227.754 182.25 227.754 C 182.25 227.754 175.029 236.247 198.572 239.662 C 222.122 243.077 250.023 251.077 250.023 251.077 C 250.023 251.077 266.541 252.379 266.541 264.948 C 266.541 276.832 272.743 264.948 272.743 264.948 L 291.333 256.854 C 291.333 256.854 293.408 259.618 318.199 256.854 C 342.992 254.091 347.89 251.106 347.89 251.106 L 366.751 233.472 L 378.478 217.529 L 388.45 200.406 L 385.341 187.999 L 328.622 173.778 L 305.84 171.463 L 294.487 158.196 C 294.487 158.196 249.435 159.419 236.76 163.893 C 228.536 166.948 221.145 170.904 214.897 175.6 Z M 515.508 354.023 L 463.851 339.552 L 436.997 332.662 L 411.17 324.401 C 411.17 324.401 371.916 298.945 392.577 269.655 L 416.335 254.822 L 428.726 238.94 L 441.13 220.335 L 447.33 217.489 L 469.017 223.098 L 484.514 222.407 L 489.681 233.423 C 489.681 233.423 513.436 236.857 515.508 259.599 C 515.508 259.599 528.933 276.813 547.524 276.813 C 566.118 276.813 567.152 299.546 554.764 304.371 L 544.431 326.402 L 527.913 338.8 L 515.508 354.023 Z M 689.044 309.589 L 652.901 312.684 L 623.976 318.051 L 591.947 318.051 L 552.691 323.058 L 546.114 323.058 L 554.836 304.461 C 554.836 304.461 571.358 285.816 547.6 276.903 C 540.802 274.237 533.783 271.831 526.577 269.693 L 515.614 259.678 C 515.614 259.678 515.614 234.182 489.785 233.503 L 480.488 217.559 L 530.045 217.559 L 569.223 194.877 C 569.223 194.877 602.264 185.233 621.905 194.877 L 649.73 188.046 C 649.73 188.046 676.596 190.761 654.898 206.605 L 648.71 223.818 C 648.71 223.818 654.898 231.399 671.431 227.263 L 672.467 245.869 L 684.857 251.106 L 682.797 260.33 L 693.716 261.872 C 705.284 263.493 711.877 271.668 707.533 278.996 L 705.517 282.381 L 706.555 294.778 L 704.484 302.349 L 689.044 309.589 Z M 520.675 357.466 L 511.378 378.135 L 507.235 397.424 C 507.235 397.424 501.062 422.198 484.542 424.281 L 483.509 481.462 L 498.524 496.543 L 486.211 505.314 C 486.211 505.314 504.23 517.334 536.202 494.55 L 567.135 482.832 C 567.135 482.832 596.06 489.012 589.872 448.386 L 590.746 426.355 C 590.746 426.355 602.264 431.862 609.5 404.993 L 616.696 378.135 L 610.492 364.366 C 610.492 364.366 610.598 364.005 610.838 363.365 C 613.296 357.443 623.193 354.444 631.5 357.106 C 636.411 358.558 643.607 358.447 653.935 354.042 C 679.75 343.027 685.953 343.027 685.953 343.027 L 685.953 326.462 L 689.044 309.589 L 635.962 315.829 C 635.962 315.829 648.575 315.829 611.572 318.051 L 574.647 320.244 L 546.114 323.058 C 546.114 323.058 519.639 345.09 520.675 357.466 Z M 516.8 89.73 C 521.169 86.214 535.977 76.452 551.536 90.731 C 551.615 90.812 551.706 90.889 551.805 90.96 L 561.507 98.652 C 562.426 99.373 563.634 99.902 564.989 100.184 C 569.781 101.184 581.762 104.141 586.269 110.137 C 591.947 117.719 586.269 113.582 586.269 113.582 L 620.492 103.659 C 621.441 103.384 622.464 103.243 623.498 103.248 L 623.886 103.248 C 627.96 103.248 631.259 105.45 631.259 108.165 L 631.259 116.479 C 631.259 117.291 631.565 118.093 632.147 118.811 L 637.611 125.579 C 638.194 126.298 638.5 127.098 638.5 127.913 L 638.5 138.868 C 638.493 139.457 638.652 140.041 638.965 140.592 L 648.651 157.866 C 648.769 158.075 648.863 158.288 648.935 158.506 L 653.65 172.527 C 653.857 173.186 653.857 173.869 653.65 174.529 L 650.57 185.305 C 650.091 187.001 648.304 188.406 645.873 188.998 L 630.555 192.754 C 628.342 193.298 625.878 193.103 623.917 192.234 C 618.075 189.65 603.703 185.124 584.723 191.713 C 566.01 198.193 556.192 202.809 552.301 204.731 C 551.191 205.279 550.346 206.03 549.868 206.895 C 548.442 209.387 543.682 215.327 529.971 217.55 C 515.569 219.882 491.436 218.391 483.224 217.78 C 481.377 217.644 479.519 217.976 478.027 218.712 L 473.297 221.045 C 470.748 222.308 467.269 222.337 464.674 221.116 L 451.297 214.837 C 450.054 214.257 449.115 213.436 448.608 212.484 L 443.187 202.469 C 443.187 202.469 447.33 203.851 426.667 199.023 C 416.179 196.601 405.153 195.377 394.051 195.397 C 390.721 195.406 387.798 193.918 386.933 191.774 C 386.032 189.566 387.54 187.233 390.567 186.156 L 415.045 177.393 L 415.598 177.173 L 425.075 173.026 C 430.218 170.898 435.945 169.473 441.926 168.841 C 445.199 168.44 451.16 165.687 461.838 156.315 L 483.04 137.798 L 483.462 137.385 L 493.884 126 L 510.658 108.236 C 511.179 107.686 511.532 107.072 511.694 106.435 L 515.283 92.082 C 515.463 91.222 515.986 90.409 516.8 89.73 Z M 443.441 202.017 L 395.943 195.199 C 395.572 195.143 395.223 195.033 394.921 194.877 L 392.939 193.876 C 391.347 193.068 389.043 193.713 388.788 195.035 C 388.764 195.162 388.761 195.291 388.78 195.417 L 388.976 196.721 C 389.007 196.946 388.971 197.175 388.87 197.391 L 379.859 217.109 C 379.818 217.198 379.769 217.287 379.709 217.369 L 368.145 233.082 C 368.097 233.147 368.057 233.213 368.025 233.282 C 367.38 234.544 360.367 247.762 349.209 250.816 C 338.053 253.87 308.661 257.286 304.803 257.736 C 304.53 257.766 304.251 257.766 303.978 257.736 L 293.648 256.734 C 293.014 256.669 292.366 256.763 291.829 256.995 L 275.146 264.244 C 274.467 264.546 274.036 265.038 273.972 265.577 L 273.585 269.303 C 273.542 269.753 273.764 270.198 274.199 270.545 L 285.974 279.786 C 286.095 279.88 286.232 279.968 286.377 280.048 L 320.12 297.071 C 321.722 297.873 324.021 297.22 324.263 295.896 C 324.263 295.889 324.265 295.879 324.268 295.87 L 324.46 294.639 C 324.588 293.781 325.649 293.118 326.939 293.087 L 352.634 292.375 C 354.352 292.324 355.665 293.382 355.276 294.497 L 353.174 300.507 C 353.174 300.507 350.305 309.299 359.014 309.039 C 367.728 308.78 377.727 304.983 378.118 306.796 C 378.435 308.308 373.462 312.703 371.782 314.146 C 371.445 314.433 371.257 314.784 371.239 315.148 C 371.239 317.15 370.518 324.03 363.656 328.365 L 356.012 333.203 C 355.719 333.388 355.495 333.618 355.368 333.874 C 353.069 338.161 332.36 377.115 335.544 382.743 C 335.544 382.743 333.323 391.694 349.209 394.679 L 364.992 397.683 L 365.232 397.742 L 379.35 401.408 C 379.649 401.49 379.969 401.529 380.295 401.527 L 400.916 401.527 L 428.741 403.382 C 428.928 403.393 429.118 403.42 429.296 403.463 L 444.119 406.745 C 444.382 406.806 444.661 406.837 444.945 406.837 L 466.584 406.837 C 467.605 406.828 468.532 407.22 468.955 407.837 L 480.728 425.674 C 481.532 426.895 484.013 427.082 485.202 426.009 C 485.487 425.75 485.658 425.443 485.701 425.122 C 485.781 424.505 486.356 423.965 487.201 423.709 C 491.001 422.489 501.784 416.991 506.844 393.327 C 511.905 369.663 519.324 363.845 521.949 362.454 C 522.564 362.121 522.914 361.619 522.898 361.091 L 522.898 354.613 C 522.9 353.347 520.926 352.505 519.204 353.041 L 517.882 353.451 C 517.205 353.646 516.439 353.646 515.765 353.451 L 412.913 324.249 C 412.633 324.171 412.382 324.059 412.163 323.92 C 408.029 321.317 367.92 294.879 393.721 269.552 C 393.838 269.44 393.976 269.335 394.128 269.243 L 417.432 254.691 C 417.586 254.601 417.724 254.496 417.837 254.381 C 418.798 253.379 423.845 247.962 432.66 234.815 C 438.951 225.37 440.273 220.795 440.423 218.791 C 440.5 217.918 441.545 217.225 442.857 217.18 L 452.737 216.759 C 454.659 216.677 455.787 215.278 454.825 214.165 L 445.14 202.889 C 444.783 202.451 444.166 202.136 443.441 202.017 Z" style=""/>

            @endif

            </svg>

            <div class="flex flex-col gap-2 -mt-24">
                <div class="text-black text-center text-2xl font-bold">
                    {{ $selectedUnionDetails?->bn_name ?? 'সদর থানা' }}
                </div>
                <div class="flex flex-wrap gap-2 justify-center text-lg">

                    @foreach ($this->crimes->unique("crime_type")->pluck("crime_type") as $crime)
                    @php
                        $thisType = $this->crimes->where("crime_type",$crime)->count();
                            $percentage = round(($thisType / $total) * 100, 1);
                        @endphp
                        <p class="text-black text-center inline-flex justify-center items-center gap-1">
                            <span style="background-color:{{ $crime }}" class="w-5 h-5 rounded-full inline-flex justify-center items-center"></span>
                        {{ ucfirst($crime) }}: {{ $thisType }} ({{ $percentage }}%)
                        </p>
                    @endforeach

                </div>
                <h5 class="text-black text-center text-2xl font-bold">
                    {{ $total }} Total Crimes
                </h5>
            </div>
    </div>
    <div>




        @foreach ($this->unions as $union)
            <x-mary-button class="{{ $selectedUnion == $union->id ? 'bg-primary text-white' : '' }}" label="{{ $union->name }}" wire:click="selectUnion({{ $union->id }})" />
        @endforeach
        <x-mary-button class="{{ $selectedUnion == null ? 'bg-primary text-white' : '' }}" label="All" wire:click="selectUnion(null)" />
    </div>

</div>
