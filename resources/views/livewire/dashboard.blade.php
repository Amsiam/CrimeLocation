<div>
    <style>
        #map-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        #map-tooltip {
            position: absolute;
            display: none;
            background: white;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        .region-overlay {
            transition: fill 0.3s ease;
        }

        .region-path {
            fill: url(#gradient) !important;
        }
    </style>

    <div id="map-container">

        <div class="flex justify-between gap-2">
            <x-mary-datetime label="Start Date" wire:model.live="startDate" />
            <x-mary-datetime label="End Date" wire:model.live="endDate" />
        </div>

<div class="">
        <svg class="w-3/4 h-1/2 -mt-16" id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 792">
            <defs>
                <style>.cls-1{fill:#e29d69;stroke:#0808a5;stroke-miterlimit:10;stroke-width:3px;}.cls-2{font-size:12px;font-family:MyriadPro-Regular, Myriad Pro;}.cls-3{letter-spacing:-0.01em;}.cls-4{letter-spacing:-0.01em;}.cls-5{letter-spacing:0.01em;}.cls-6{letter-spacing:0.02em;}.cls-7{letter-spacing:0em;}.cls-8{letter-spacing:0em;}.cls-9{letter-spacing:0em;}.cls-10{letter-spacing:0em;}.cls-11{letter-spacing:0em;}.cls-12{letter-spacing:0.02em;}.cls-13{letter-spacing:0.02em;}.cls-14{letter-spacing:0em;}.cls-15{letter-spacing:-0.01em;}.cls-16{letter-spacing:0.01em;}</style>
              </defs>

            @if ($selectedUnion)
                {!! str_replace("TOTALCRIME",$this->crimes->count(),$selectedUnionDetails->path) !!}


            @else


              <path class="cls-1" d="M 188.376 268.661 C 186.063 263.766 189.239 264.734 189.239 251.231 C 189.239 237.726 215.041 239.662 189.239 237.726 C 163.437 235.791 199.127 211.085 163.437 235.806 C 137.597 253.671 140.222 254.133 140.222 254.133 C 134.512 248.247 128.479 242.768 122.158 237.726 C 112.157 229.693 109.257 232.203 109.257 232.203 C 109.257 232.203 110.982 249.029 98.081 244.36 C 85.179 239.689 81.742 231.949 81.742 231.949 L 60.24 231.949 L 48.202 236.774 L 38.751 255.087 L 23.275 268.591 L 6.935 281.14 L 6.935 328.397 L 16.386 348.659 C 16.386 348.659 13.811 348.659 13.811 370.842 L 13.811 393.025 L 26.712 388.201 L 44.763 386.281 L 67.99 376.38 L 85.179 376.38 L 110.982 360.227 L 131.621 352.515 L 158.287 332.266 L 165.162 317.795 L 171.187 298.5 L 178.076 284.997 L 188.376 268.661 Z" style="stroke: rgb(78, 78, 143);"/>
              <path class="cls-1" d="M 64.54 496.243 C 64.54 496.243 106.681 445.119 131.621 496.243 L 142.798 511.669 C 142.798 511.669 151.685 514.249 151.398 522.283 C 150.661 543.134 161.724 539.643 161.724 539.643 C 161.724 539.643 153.123 538.69 172.9 539.643 C 192.677 540.597 182.363 549.29 192.677 540.611 C 202.99 531.931 202.14 542.545 203.003 531.931 C 203.865 521.316 212.454 521.316 203.003 500.1 L 193.539 478.884 L 185.801 458.621 L 181.501 437.406 L 176.338 405.575 C 176.338 405.575 167.899 369.777 150.536 364.097 C 123.97 355.375 119.758 356.96 119.758 356.96 C 119.758 356.96 102.431 376.38 85.179 376.38 L 67.99 376.38 C 67.99 376.38 53.065 372.174 48.914 384.513 C 44.763 396.853 48.914 412.32 48.914 412.32 L 56.802 427.745 C 56.802 427.745 57.665 426.778 58.527 446.072 L 59.39 465.352 L 54.228 479.823 L 64.54 496.243 Z" style=""/>
              <path class="cls-1" d="M 211.591 530.963 C 211.591 530.963 218.904 529.561 224.492 530.963 C 244.419 536.124 234.818 537.723 243.419 539.643 L 252.019 541.577 L 271.797 541.577 L 287.273 544.383 C 287.273 544.383 288.423 548.435 295.011 506.788 C 303.224 454.905 308.763 482.685 313.925 458.566 C 319.088 434.447 333.715 436.383 319.088 434.447 C 304.462 432.512 310.488 449.872 304.474 432.526 C 298.461 415.18 317.375 414.199 298.449 415.152 L 279.535 416.12 C 279.535 416.12 289.348 435.863 266.384 414.9 L 243.419 393.937 L 232.23 376.38 C 232.23 376.38 241.693 368.135 218.48 356.96 C 195.265 345.783 221.054 353.482 195.252 345.741 C 169.45 338.001 180.638 343.806 169.462 338.016 L 158.287 332.239 L 127.234 354.127 L 155.249 366.018 L 176.338 405.547 L 180.563 431.6 C 180.563 431.6 184.076 457.626 193.539 478.857 C 198.699 490.165 203.339 501.762 207.441 513.604 L 211.591 530.963 Z" style=""/>
              <path class="cls-1" d="M 166.874 606.208 C 166.874 606.208 166.874 599.448 188.376 589.802 L 209.878 580.154 C 209.878 580.154 212.166 576.788 230.517 569.553 C 255.145 559.835 255.52 560.874 255.52 560.874 L 284.697 550.258 L 287.273 544.439 C 287.273 544.439 298.449 561.826 308.775 561.826 C 319.1 561.826 316.513 570.52 341.453 570.52 L 366.392 570.52 L 379.281 575.317 L 399.07 575.317 L 409.384 606.165 L 412.822 624.577 L 412.822 679.559 C 412.822 679.559 435.186 703.677 420.56 710.408 L 405.945 717.124 L 402.571 717.979 C 397.97 719.157 393.482 716.845 390.469 712.763 C 388.907 710.632 384.219 709.286 373.268 710.366 C 344.027 713.255 352.629 719.045 344.027 713.255 C 335.427 707.463 355.204 708.445 335.427 707.478 C 315.65 706.51 334.564 710.366 315.65 706.51 C 296.736 702.653 313.076 701.686 296.736 702.653 C 280.397 703.621 288.998 700.718 280.397 703.621 L 271.797 706.51 L 258.896 707.478 L 230.517 694.857 C 230.517 694.857 226.418 692.936 207.403 691 L 188.376 689.08 L 171.187 689.08 L 151.398 686.275 L 132.434 680.484 C 132.434 680.484 128.134 673.725 147.048 656.365 L 147.91 633.201 C 147.91 633.201 147.91 617.777 157.374 611.998 L 166.874 606.208 Z" style=""/>
              <path class="cls-1" d="M 255.457 226.86 C 255.457 226.86 205.578 231.614 230.456 226.86 C 239.793 225.092 243.831 227.098 247.619 221.012 C 249.322 218.063 250.775 214.942 251.957 211.687 C 257.97 196.263 244.206 208.786 257.97 196.263 C 271.734 183.741 256.257 195.295 271.721 183.727 L 287.198 172.144 C 286.335 149.961 288.061 165.399 286.335 149.961 C 284.61 134.523 296.661 152.863 284.622 134.536 L 272.584 116.21 L 267.446 99.789 C 267.446 99.789 254.545 98.821 266.583 78.573 L 278.697 58.311 L 290.136 43.839 L 294.174 39.984 L 304.499 39.984 L 325.439 26.48 C 325.439 26.48 350.079 -5.352 370.718 26.48 C 370.718 26.48 386.194 26.48 377.593 35.16 L 368.993 43.839 L 385.331 51.566 L 401.671 66.037 L 425.547 93.044 L 436.073 116.195 L 436.073 155.739 L 421.448 181.778 C 421.448 181.778 420.585 183.712 407.696 206.863 C 399.672 220.959 388.346 232.305 374.955 239.662 L 347.454 259.91 C 347.454 259.91 332.839 269.558 331.114 268.591 L 329.402 267.637 C 329.402 267.637 284.697 244.486 264.946 245.44 L 255.495 226.86 L 255.457 226.86 Z" style=""/>
              <path class="cls-1" d="M 189.239 251.231 C 189.239 251.231 187.177 264.313 178.063 284.997 C 168.95 305.679 162.062 324.26 162.062 324.26 C 162.062 324.26 156.049 336.15 175.651 340.932 C 195.252 345.714 218.48 356.917 218.48 356.917 C 218.48 356.917 232.23 358.741 232.23 376.339 C 232.23 392.984 237.394 376.339 237.394 376.339 L 252.87 365.009 C 252.87 365.009 254.595 368.878 275.234 365.009 C 295.873 361.138 299.949 356.96 299.949 356.96 L 315.65 332.266 L 325.414 309.943 L 333.715 285.964 L 331.127 268.591 L 283.909 248.678 L 264.946 245.44 L 255.495 226.86 C 255.495 226.86 217.992 228.57 207.441 234.838 C 200.594 239.114 194.439 244.656 189.239 251.231 Z" style=""/>
              <path class="cls-1" d="M 439.486 501.067 L 396.482 480.805 L 374.131 471.158 L 352.629 459.589 C 352.629 459.589 319.951 423.945 337.152 382.929 L 356.929 362.162 L 367.242 339.922 L 377.568 313.869 L 382.732 309.887 L 400.783 317.739 L 413.684 316.772 L 417.984 332.195 C 417.984 332.195 437.761 337.005 439.486 368.85 C 439.486 368.85 450.662 392.955 466.138 392.955 C 481.615 392.955 482.478 424.786 472.164 431.546 L 463.564 462.393 L 449.812 479.754 L 439.486 501.067 Z" style=""/>
              <path class="cls-1" d="M 583.949 438.85 L 553.859 443.184 L 529.781 450.699 L 503.117 450.699 L 470.439 457.71 L 464.963 457.71 L 472.227 431.671 C 472.227 431.671 485.978 405.561 466.201 393.082 C 460.542 389.348 454.699 385.978 448.699 382.986 L 439.574 368.963 C 439.574 368.963 439.574 333.263 418.072 332.308 L 410.334 309.984 L 451.588 309.984 L 484.203 278.224 C 484.203 278.224 511.706 264.721 528.057 278.224 L 551.222 268.661 C 551.222 268.661 573.586 272.461 555.521 294.644 L 550.371 318.748 C 550.371 318.748 555.521 329.364 569.285 323.573 L 570.148 349.625 L 580.461 356.96 L 578.748 369.874 L 587.837 372.033 C 597.467 374.301 602.957 385.748 599.338 396.012 L 597.663 400.751 L 598.525 418.111 L 596.8 428.712 L 583.949 438.85 Z" style=""/>
              <path class="cls-1" d="M 443.787 505.891 L 436.049 534.834 L 432.599 561.841 C 432.599 561.841 427.46 596.533 413.709 599.448 L 412.846 679.516 L 425.348 700.634 L 415.097 712.918 C 415.097 712.918 430.098 729.744 456.712 697.844 L 482.466 681.438 C 482.466 681.438 506.542 690.089 501.392 633.201 L 502.117 602.351 C 502.117 602.351 511.706 610.063 517.73 572.442 L 523.719 534.834 L 518.556 515.552 C 518.556 515.552 518.644 515.048 518.844 514.151 C 520.89 505.856 529.129 501.659 536.045 505.386 C 540.132 507.419 546.121 507.265 554.721 501.096 C 576.211 485.67 581.374 485.67 581.374 485.67 L 581.374 462.478 L 583.949 438.85 L 539.758 447.586 C 539.758 447.586 550.259 447.586 519.456 450.699 L 488.716 453.77 L 464.963 457.71 C 464.963 457.71 442.924 488.559 443.787 505.891 Z" style=""/>
              <path class="cls-1" d="M 440.561 130.989 C 444.199 126.067 456.525 112.394 469.476 132.391 C 469.545 132.504 469.619 132.613 469.702 132.714 L 477.778 143.483 C 478.543 144.491 479.55 145.234 480.678 145.628 C 484.665 147.029 494.641 151.167 498.392 159.566 C 503.117 170.18 498.392 164.39 498.392 164.39 L 526.881 150.494 C 527.67 150.108 528.522 149.912 529.382 149.918 L 529.706 149.918 C 533.097 149.918 535.845 153.001 535.845 156.804 L 535.845 168.443 C 535.845 169.584 536.099 170.706 536.583 171.71 L 541.132 181.189 C 541.617 182.191 541.871 183.316 541.871 184.457 L 541.871 199.797 C 541.866 200.621 541.998 201.438 542.258 202.209 L 550.322 226.397 C 550.418 226.69 550.499 226.99 550.558 227.294 L 554.484 246.926 C 554.654 247.851 554.654 248.805 554.484 249.731 L 551.921 264.819 C 551.52 267.196 550.033 269.161 548.009 269.993 L 535.257 275.251 C 533.418 276.01 531.365 275.739 529.732 274.522 C 524.869 270.904 512.906 264.566 497.104 273.793 C 481.527 282.865 473.351 289.329 470.114 292.022 C 469.19 292.788 468.486 293.841 468.089 295.05 C 466.902 298.543 462.939 306.857 451.525 309.97 C 439.537 313.238 419.447 311.148 412.608 310.293 C 411.072 310.102 409.528 310.568 408.283 311.598 L 404.346 314.865 C 402.224 316.634 399.329 316.674 397.17 314.963 L 386.031 306.17 C 384.998 305.36 384.217 304.208 383.794 302.875 L 379.281 288.853 C 379.281 288.853 382.732 290.788 365.529 284.028 C 356.798 280.637 347.619 278.921 338.378 278.953 C 335.605 278.965 333.171 276.88 332.452 273.877 C 331.7 270.784 332.957 267.52 335.477 266.01 L 355.854 253.741 L 356.316 253.433 L 364.205 247.627 C 368.485 244.645 373.254 242.652 378.23 241.766 C 380.956 241.205 385.919 237.348 394.808 224.224 L 412.459 198.297 L 412.809 197.722 L 421.485 181.778 L 435.448 156.902 C 435.883 156.134 436.177 155.275 436.311 154.378 L 439.299 134.284 C 439.448 133.078 439.884 131.94 440.561 130.989 Z" style=""/>
              <path class="cls-1" d="M 379.494 288.222 L 339.952 278.672 C 339.643 278.595 339.353 278.443 339.103 278.224 L 337.452 276.821 C 336.127 275.691 334.208 276.592 333.997 278.445 C 333.977 278.623 333.975 278.803 333.99 278.981 L 334.152 280.804 C 334.178 281.12 334.149 281.44 334.065 281.743 L 326.563 309.353 C 326.53 309.478 326.487 309.601 326.439 309.718 L 316.813 331.718 C 316.771 331.809 316.739 331.903 316.713 332 C 316.175 333.766 310.337 352.276 301.049 356.553 C 291.761 360.83 267.296 365.612 264.083 366.243 C 263.855 366.284 263.623 366.284 263.396 366.243 L 254.795 364.84 C 254.267 364.748 253.729 364.878 253.282 365.204 L 239.394 375.356 C 238.829 375.777 238.471 376.465 238.418 377.221 L 238.093 382.439 C 238.059 383.07 238.242 383.693 238.606 384.176 L 248.407 397.119 C 248.51 397.252 248.623 397.374 248.745 397.485 L 276.834 421.322 C 278.164 422.445 280.08 421.53 280.281 419.676 C 280.282 419.664 280.283 419.653 280.284 419.64 L 280.447 417.915 C 280.554 416.714 281.435 415.784 282.51 415.742 L 303.9 414.746 C 305.33 414.676 306.424 416.155 306.099 417.718 L 304.35 426.132 C 304.35 426.132 301.962 438.443 309.213 438.079 C 316.463 437.715 324.789 432.4 325.113 434.938 C 325.376 437.055 321.238 443.211 319.838 445.23 C 319.559 445.633 319.402 446.123 319.388 446.633 C 319.388 449.438 318.788 459.071 313.076 465.142 L 306.712 471.914 C 306.466 472.174 306.282 472.496 306.175 472.854 C 304.262 478.857 287.023 533.403 289.672 541.284 C 289.672 541.284 287.823 553.819 301.049 557.999 L 314.188 562.206 L 314.388 562.289 L 326.139 567.421 C 326.388 567.533 326.656 567.591 326.926 567.59 L 344.09 567.59 L 367.254 570.184 C 367.413 570.201 367.567 570.238 367.718 570.297 L 380.056 574.895 C 380.277 574.979 380.51 575.022 380.743 575.022 L 398.758 575.022 C 399.605 575.008 400.38 575.559 400.732 576.424 L 410.533 601.398 C 411.199 603.109 413.266 603.371 414.257 601.87 C 414.495 601.506 414.639 601.076 414.671 600.626 C 414.74 599.762 415.217 599.006 415.921 598.649 C 419.084 596.938 428.06 589.24 432.273 556.106 C 436.486 522.971 442.661 514.824 444.85 512.874 C 445.359 512.408 445.65 511.705 445.636 510.967 L 445.636 501.895 C 445.639 500.12 443.996 498.945 442.561 499.693 L 441.461 500.268 C 440.899 500.543 440.262 500.543 439.698 500.268 L 354.079 459.379 C 353.847 459.268 353.635 459.112 353.453 458.916 C 350.016 455.271 316.625 418.252 338.103 382.788 C 338.201 382.631 338.315 382.486 338.439 382.354 L 357.842 361.98 C 357.971 361.851 358.083 361.705 358.179 361.545 C 358.98 360.143 363.179 352.557 370.518 334.145 C 375.756 320.921 376.856 314.513 376.981 311.709 C 377.043 310.487 377.916 309.514 379.006 309.452 L 387.231 308.863 C 388.832 308.749 389.77 306.79 388.97 305.231 L 380.906 289.442 C 380.608 288.831 380.096 288.388 379.494 288.222 Z" style=""/>
              <text class="cls-2" transform="matrix(1.250111, 0, 0, 1.402238, 320.246887, 139.053253)" style="white-space: pre;">বারুইপাড়া</text>
              <text class="cls-2" transform="matrix(1.250111, 0, 0, 1.402238, 438.097961, 221.558624)" style="white-space: pre;">বিষ্ণুপুর</text>
              <text class="cls-2" transform="matrix(1.250111, 0, 0, 1.47211, 50.25713, 294.100372)" style="white-space: pre;">রাখালগাছি</text>
              <text class="cls-2" transform="matrix(1.250111, 0, 0, 1.402238, 490.690857, 358.773102)" style="white-space: pre;">গোটাপাড়া</text>
              <text class="cls-2" transform="matrix(1.250111, 0, 0, 1.402238, 381.981171, 405.897583)" style="white-space: pre;"> </text>
              <text class="cls-2" transform="matrix(1.250111, 0, 0, 1.402238, 445.536774, 567.276794)" style="white-space: pre;">বেমরতা</text>
              <text class="cls-2" transform="matrix(1.594056, 0, 0, 1.780895, 275.839966, 636.981628)" style="white-space: pre;">ডেমা</text>
              <text class="cls-2" transform="matrix(1.250111, 0, 0, 1.402238, 94.276787, 415.468842)" style="white-space: pre;">খানপুর</text>
              <text class="cls-2" transform="matrix(1.250111, 0, 0, 1.402238, 212.9272, 451.248627)" style="white-space: pre;">ষাটগুম্বজ</text>
              <text class="cls-2" transform="matrix(1.250111, 0, 0, 1.402238, 225.427261, 293.393646)" style="white-space: pre;">যাত্রাপুর</text>
              <text class="cls-2" transform="matrix(1.250111, 0, 0, 1.402238, 321.871033, 501.352814)" style="white-space: pre;">কাড়াপাড়া</text>
              <text style="fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 16px;" x="386.988" y="415.614" transform="matrix(1.113218, 0, 0, 1.177787, -43.81366, -93.314857)">সদর</text>
              <text style="fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 19px;" x="72.096" y="313.831">
                {{-- rakhalagachi --}}
                {{ $this->crimes->where("union_id","8")->count() }}
              </text>
              <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="200" y="176">
                {{ $this->crimes->where("union_id","12")->count() }}
                {{-- baruipara --}}
              </text>
              <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="170" y="253.855">
                {{-- bishnupur --}}
                {{ $this->crimes->where("union_id","13")->count() }}
              </text>
              <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="250.795" y="395.47">
                {{-- gotapara --}}
                {{ $this->crimes->where("union_id","6")->count() ?? 0 }}
              </text>
              <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="190.928" y="597.494">
                {{-- bemotar --}}
                {{ $this->crimes->where("union_id","4")->count() }}
              </text>
              <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="20.108" y="669.831">
                {{-- dema --}}
                {{ $this->crimes->where("union_id","7")->count() }}
              </text>
              <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="55.626" y="531.843">
                {{-- karapara --}}
                {{ $this->crimes->where("union_id","3")->count() }}
              </text>
              <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="-15.976" y="493.012" >
                {{-- shatagumbaj --}}
                {{ $this->crimes->where("union_id","10")->count() }}
              </text>
              <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="-140.614" y="457.108">
                {{-- khanpur --}}
                {{ $this->crimes->where("union_id","9")->count() }}
              </text>
              <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="-10.012" y="324.072">
                {{-- jhatrapur --}}
                {{ $this->crimes->where("union_id","11")->count() }}
              </text>
              <text style="white-space: pre; fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 28px;" x="120" y="431.819">
                {{-- sadar --}}
                {{ $this->crimes->where("union_id","5")->count() }}
              </text>


            @endif

            </svg>
        </div>

            <div class="flex flex-col gap-2 -mt-16">
                <div class="text-black text-center text-2xl font-bold">
                    {{ $selectedUnionDetails?->bn_name ?? 'সদর থানা' }}
                </div>
                <div class="flex flex-wrap gap-2 justify-center text-lg">

                    @php
                        $total = $this->crimes->count();
                    @endphp

                    @foreach ($this->crimes->unique("crime_type")->pluck("crime_type") as $crime)
                    @php
                        $thisType = $this->crimes->where("crime_type",$crime)->count();
                        $percentage = round(($thisType / $total) * 100, 1);
                    @endphp
                    <p class="text-black text-center inline-flex justify-center items-center gap-1">
                            <span style="background-color:{{ $crime }}" class="w-5 h-5 rounded-full inline-flex justify-center items-center"></span>
                        {{ ucfirst($crime) }}: {{ $thisType }} ({{ $percentage }}%)
                        </p>
                    @endforeach

                </div>
                <h5 class="text-black text-center text-2xl font-bold">
                    {{ $total }} Total Crimes
                </h5>
            </div>
    </div>
    <div>



        <x-mary-button class="{{ $selectedUnion == null ? 'bg-primary text-white' : '' }}" label="All" wire:click="selectUnion(null)" />

        @foreach ($this->unions as $union)
            <x-mary-button class="{{ $selectedUnion == $union->id ? 'bg-primary text-white' : '' }}" label="{{ $union->name }}" wire:click="selectUnion({{ $union->id }})" />
        @endforeach
    </div>

</div>
